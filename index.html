<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>index</title>
  </head>
  <script src="painter.js"></script>

  <body>
    <canvas id="c"></canvas>
  </body>
  <script>
    const cvs = document.getElementById("c");
    const ctx = cvs.getContext("2d");

    const data = {
      xPadding: 200,
      yPadding: 10,
      globalStyle: {
        background: "white",
        foreground: "black",
        borderColor: "blue",
        borderWidth: 5,
        font: "20px Calibri",
        padding: 10,
        radius: 10,
      },
      images: {
        1: {
          src:
            "https://pic2.zhimg.com/v2-4e96f1110cb872407e837d4fc1440f96_1440w.jpg?source=172ae18b",
          height: 100,
          width: 100,
          padding: { top: 10, right: 0, bottom: -5, left: 30 },
        },
      },
      connectionStyle: {
        width: 3,
        color: "black",
      },
      node: {
        content: "main node",
        children: [
          {
            content: "child1",
            hotSpot: {
              action: "draw",
            },
            children: [
              {
                connectionStyle: {
                  width: "2",
                  color: "green",
                },
                content: "level3\nnew line",
                children: [
                  {
                    content: "TYPESCRIPT!!",
                    style: {
                      background: "#1e1e1e",
                      foreground: "white",
                      borderColor: "#9cdcfe",
                      borderWidth: "2",
                      font: "20px Calibri",
                      padding: 10,
                      radius: 20,
                    },
                    image: 1,
                  },
                  {
                    content: "3-1yyy",
                  },
                  {
                    content: "3-11111",
                  },
                  {
                    content: "3-1",
                  },
                  {
                    content: "3-1",
                  },
                  {
                    content: "3-1",
                  },
                  {
                    content: "3-1",
                    bg: "",
                  },
                ],
              },
              {
                content: "level3",
              },
              {
                content: "level3",
              },
            ],
          },
          {
            content:
              "child2\nnew line\nnew line\nnew line\nnew line\nnew line\nnew line\nnew line\nnew line",
            children: [
              {
                content: "2-1",
              },
              {
                content: "2-2",
              },
            ],
          },
          {
            content: "child3",
            children: [
              {
                content: "3-1",
              },
            ],
          },
        ],
      },
    };

    cvs.height = window.innerHeight - 20;
    cvs.width = window.innerWidth - 100;

    const p = new painter(data);
    p.initImg(() => {
      rebuild();
    });
    ctx.clearRect(0, 0, window.outerWidth, cvs.clientHeight);
    let offsetY = 0;
    function rebuild() {
      if (p.imageLoaded) {
        p.build(ctx, 1, 0, offsetY);
      }
    }

    rebuild();

    let currentHotspot;

    cvs.onmousemove = (e) => {
      currentHotspot = p.getCurrentHotSpot({ x: e.x, y: e.y });
      if (currentHotspot != undefined) {
        cvs.style.cursor = "pointer";
      } else {
        cvs.style.cursor = "default";
      }
    };

    window.onresize = () => {
      rebuild();
    };

    cvs.onclick = () => {
      console.log(currentHotspot);
    };
    cvs.onwheel = (e) => {
      offsetY -= e.deltaY;
      ctx.clearRect(0, 0, window.outerWidth, cvs.clientHeight);
      rebuild();
      if (e.ctrlKey) {
      }
    };
  </script>
</html>
